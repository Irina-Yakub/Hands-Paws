<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Sign-up</title>
<link rel="stylesheet" href="CSS/reset.css">
<link rel="stylesheet" href="CSS/reg.css">
<link rel="stylesheet" href="CSS/fonts.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
<style>
  
</style>
</head>
<body>
<div class="main">
  <a href="/" id="home"><img src="/HTML/img/home.png" alt=""></a>
<div class="header">РЕЄСТРАЦІЯ</div>
<div class="blok-center">
    <div class="tab">
        <a class="tablinks tone" onclick="openPage(event, 'Refuge')" id="defaultOpen">Притулок</a>
        <a class="tablinks ttwo"  onclick="openPage(event, 'User')">Гість</a>
    </div>
    <div class="center">
      <form id="Refuge" class="tabcontent" method="POST" action="../../backend/insRefuge.php">
          <p>Назва: </p>
          <input class="input" name="nameRef" ENGINE="text" autocomplete="off" placeholder="Назва притулку"/></p>
          <p>Країна:</p>
            <select id="country" name="countryRef">
              <option value="Ukraine">Україна</option>
              <option value="Russia">Росія</option>
              <option value="Poland">Польща</option>
            </select>
          <p>Адреса:</p>
          <input class="input" name="Address" type="text"  autocomplete="off" placeholder="Ваше місто"/></p>
          <!-- <p>Телефон:<br />
            <input type="tel" id="phone" name="phone" maxlength="10">                       В файл профіля             -->
          <p>Пошта:</p>
              <input class="input" type="email" name="mailRef" type="text"  placeholder="E-mail"/></p>
          <p>Пароль:</p>
              <input class="input" type="password" name="passRef" placeholder="Пароль" required>
              <div class="border-gradient1">
                <p><input type="submit" id="submit" value="Зареєструвати" name="save"  /></p>
              </div>
      </form>
    </div>
    <div class="center">
      <form id="User" class="tabcontent" method="POST" action="../../backend/insUser.php">
        <p>П І Б:<br />
      <input class="input" name="nameUser" ENGINE="text"  autocomplete="off" placeholder="Ваше повне ім'я"/></p>
      <p>Країна: </p>
        <select id="country" name="countryUser">
          <option value="Ukraine">Україна</option>
          <option value="Russia">Росія</option>
          <option value="Poland">Польща</option>
        </select>
      <p>Моб. телефон:</p>
      <input class="input" name="phone" type="text"  autocomplete="off" maxlength="10" placeholder="Ваш номер"/></p>
          <p>Пошта:</p>
          <input class="input" type="email" name="mailUser" type="text"  placeholder="E-mail"/></p>
        <p>Пароль:</p> 
          <input class="input" type="password" name="passUser" placeholder="Пароль" required>
          <div class="border-gradient1">
            <p><input type="submit" id="submit" value="Зареєструвати" name="save"  /></p>
          </div>
      </form>
    </div>
</div>
</div>
<script>
(() => {
  const userForm = document.getElementById('User')
  const refForm = document.getElementById('Refuge')

  userForm.addEventListener('submit', registerUser)
  refForm.addEventListener('submit', registerRef)

  async function registerUser(event) {
    event.preventDefault()
    const res = await fetch('/api/register/user', 
      {
        method: 'POST',
        headers: {
          'Content-type': 'application/json'
        },
        body: JSON.stringify(collectUserData())
      })
    const contentType = res.headers.get("content-type")
    if (contentType && contentType.indexOf("application/json") !== -1) {
      const json = await res.json()
      console.log(json)
      return
    }

    document.location = 'http://localhost:3000'
  }

  async function registerRef(event) {
    event.preventDefault()
    const res = await fetch('/api/register/refuge', 
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(collectRefData())
      })
      
    const contentType = res.headers.get("content-type")
    if (contentType && contentType.indexOf("application/json") !== -1) {
      const json = await res.json()
      console.log(json)
      return
    }

    document.location = 'http://localhost:3000'
  }

  function collectRefData() {
    const name = document.getElementsByName('nameRef')[0].value
    const country = document.getElementsByName('countryRef')[0].value
    const address = document.getElementsByName('Address')[0].value
    const email = document.getElementsByName('mailRef')[0].value
    const password = document.getElementsByName('passRef')[0].value
    return { name, country, address, email, password }
  }

  function collectUserData() {
    const name = document.getElementsByName('nameUser')[0].value
    const country = document.getElementsByName('countryUser')[0].value
    const phone = document.getElementsByName('phone')[0].value
    const email = document.getElementsByName('mailUser')[0].value
    const password = document.getElementsByName('passUser')[0].value
    return { name, country, phone, email, password }
  }

})()
function openPage(evt, pageName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(pageName).style.display = "block";
      evt.currentTarget.className += " active";
}
document.getElementById("defaultOpen").click();
</script>
</body>
</html>